# ğŸšŠ ì„œë¹„ìŠ¤ ìš”êµ¬ì‚¬í•­
## **ğŸš’Â ì§ˆë¬¸ ëª©ë¡ í™”ë©´**

- íšŒì›ê°€ì…
- ë¡œê·¸ì¸
- ë¡œê·¸ì•„ì›ƒ
- ê°œì¸ì •ë³´ ìˆ˜ì •
- ì§ˆë¬¸í•˜ê¸°
- ê° ì§ˆë¬¸ ì œëª©ì„ í´ë¦­í•˜ì—¬ ìƒì„¸ë³´ê¸° í™”ë©´ìœ¼ë¡œ ì´ë™
    - ë‹µë³€ ì¶”ê°€, ì§ˆë¬¸ê³¼ ë‹µë³€ì˜ ìˆ˜ì •/ì‚­ì œ

---

# **ğŸš² ë¡œì»¬ ê°œë°œ í™˜ê²½ êµ¬ì¶•**

ğŸ’¡ ìë°” 8ë²„ì „ & Intellij í†µí•© ê°œë°œ í™˜ê²½
- [GitHub - slipp/web-application-server: ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë²„ ì‹¤ìŠµì„ ìœ„í•œ ë¼ˆëŒ€](https://github.com/slipp/web-application-server)
- [á„á…¥á„†á…µá„‚á…¥á†¯á„‹á…¦á„‰á…¥ git clone á„†á…µá†¾ eclipseá„…á…© í”„ë¡œì íŠ¸ import](https://www.youtube.com/watch?v=5hjYe_PggJI)

---

# **ğŸš ì›ê²© ì„œë²„ì— ë°°í¬**

ğŸ’¡ ì• ìì¼ í”„ë¡œì„¸ìŠ¤ì˜ ì ‘ê·¼ ë°©ì‹
: í˜„ ì‹œì ì— ê°€ì¥ ê°€ì¹˜ìˆëŠ”, ë™ì‘í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë§Œë“œëŠ” ê²ƒì„ ì›ì¹™ìœ¼ë¡œ í•˜ëŠ” ë°©ì‹ì´ë‹¤.

ë¡œì»¬ ê°œë°œ í™˜ê²½ì„ êµ¬ì¶•í•œ í›„ ë°”ë¡œ ì‹¤ìŠµ ë‹¨ê³„ë¥¼ ì§„í–‰í•  ìˆ˜ ìˆì§€ë§Œ ì‹¤ìŠµì„ ì§„í–‰í•˜ê¸° ì „ì— ë¨¼ì € HTTP ì›¹ ì„œë²„ë¥¼ ì›ê²© ì„œë²„ì— ë°°í¬í•´ë³´ì. ì´ëŸ¬í•œ ê²½í—˜ì„ í†µí•´ í„°ë¯¸ë„ í™˜ê²½ì—ì„œ ì‘ì—…í•˜ëŠ” ê²ƒì— ìµìˆ™í•´ì§€ë„ë¡ í•œë‹¤.

https://opentutorials.org/module/1946 ì°¸ê³ í•˜ì—¬ AWSì— ëŒ€í•œ íšŒì›ê°€ì…, ìš°ë¶„íˆ¬ ìš´ì˜ì²´ì œ ì„¤ì¹˜, SSHë¥¼ í†µí•œ ì ‘ê·¼ì„ ì§„í–‰í•  ìˆ˜ ìˆë‹¤.

## **ğŸš‡ ìš”êµ¬ì‚¬í•­**

ë¡œì»¬ ê°œë°œ í™˜ê²½ì— ì„¤ì¹˜í•œ HTTP ì›¹ ì„œë²„ë¥¼ ë¬¼ë¦¬ì ìœ¼ë¡œ ë–¨ì–´ì ¸ ìˆëŠ” ì›ê²© ì„œë²„ì— ë°°í¬í•´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•œë‹¤.

---

# **ğŸš„ ì›¹ ì„œë²„ ì‹¤ìŠµ**

## **ğŸ’º ì‹¤ìŠµ í™˜ê²½ ì„¸íŒ… ë° ì†ŒìŠ¤ì½”ë“œ ë¶„ì„**

ì‹¤ìŠµìœ¼ë¡œ ì§„í–‰í•  HTTP ì›¹ ì„œë²„ëŠ” ì•ì˜ ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ ì„¸íŒ…í•œ Git ì €ì¥ì†Œì˜ **master** ë¸Œëœì¹˜ì—ì„œ ì‹œì‘í•˜ë©´ ëœë‹¤.

ì‹¤ìŠµ HTTP ì›¹ ì„œë²„ì˜ í•µì‹¬ì´ ë˜ëŠ” ì½”ë“œëŠ” webserver íŒ¨í‚¤ì§€ì˜ `WebServer`, `RequestHandler` í´ë˜ìŠ¤ì´ë‹¤.

- `WebServer` í´ë˜ìŠ¤ëŠ” ì›¹ ì„œë²„ë¥¼ ì‹œì‘í•˜ê³ , ì‚¬ìš©ìì˜ ìš”ì²­ì´ ìˆì„ ë•Œê¹Œì§€ ëŒ€ê¸° ìƒíƒœì— ìˆë‹¤ê°€ ì‚¬ìš©ì ìš”ì²­ì´ ìˆì„ ê²½ìš° í•´ë‹¹ ìš”ì²­ì„ `RequestHandler` í´ë˜ìŠ¤ì— ìœ„ì„í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•œë‹¤.

```java
// in WebServer.java
try (ServerSocket listenSocket = new ServerSocket(port)) {
  log.info("Web Application Server started {} port.", port);

  // í´ë¼ì´ì–¸íŠ¸ê°€ ì—°ê²°ë ë•Œê¹Œì§€ ëŒ€ê¸°í•œë‹¤.
  Socket connection;
  while ((connection = listenSocket.accept()) != null) {
      RequestHandler requestHandler = new RequestHandler(connection);
      requestHandler.start();
  }
}
```

- ì‚¬ìš©ì ìš”ì²­ì´ ë°œìƒí•  ë•Œê¹Œì§€ ëŒ€ê¸° ìƒíƒœì— ìˆë„ë¡ ì§€ì›í•˜ëŠ” ì—­í• ì€ ìë°”ì— í¬í•¨ë˜ì–´ ìˆëŠ” `ServerSocket`í´ë˜ìŠ¤ê°€ ë‹´ë‹¹í•œë‹¤.
- ì‚¬ìš©ì ìš”ì²­ì´ ë°œìƒí•˜ëŠ” ìˆœê°„ í´ë¼ì´ì–¸íŠ¸ì™€ ì—°ê²°ì„ ë‹´ë‹¹í•˜ëŠ” Socket ì„ `RequestHandler`ì— ì „ë‹¬í•˜ë©´ì„œ ìƒˆë¡œìš´ ìŠ¤ë ˆë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ **ë©€í‹°ìŠ¤ë ˆë“œ í”„ë¡œê·¸ë˜ë°**ì„ ì§€ì›í•œë‹¤.

```java
// in RequestHandler.java
package webserver;

import java.io.DataOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.Socket;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class RequestHandler extends Thread {
    private static final Logger log = LoggerFactory.getLogger(RequestHandler.class);

    private Socket connection;

    public RequestHandler(Socket connectionSocket) {
        this.connection = connectionSocket;
    }

    public void run() {
        log.debug("New Client Connect! Connected IP : {}, Port : {}", connection.getInetAddress(),
                connection.getPort());

        try (InputStream in = connection.getInputStream(); OutputStream out = connection.getOutputStream()) {
            // TODO ì‚¬ìš©ì ìš”ì²­ì— ëŒ€í•œ ì²˜ë¦¬ëŠ” ì´ ê³³ì— êµ¬í˜„í•˜ë©´ ëœë‹¤.
            DataOutputStream dos = new DataOutputStream(out);
            byte[] body = "Hello World".getBytes();
            response200Header(dos, body.length);
            responseBody(dos, body);
        } catch (IOException e) {
            log.error(e.getMessage());
        }
    }

    private void response200Header(DataOutputStream dos, int lengthOfBodyContent) {
        try {
            dos.writeBytes("HTTP/1.1 200 OK \r\n");
            dos.writeBytes("Content-Type: text/html;charset=utf-8\r\n");
            dos.writeBytes("Content-Length: " + lengthOfBodyContent + "\r\n");
            dos.writeBytes("\r\n");
        } catch (IOException e) {
            log.error(e.getMessage());
        }
    }

    private void responseBody(DataOutputStream dos, byte[] body) {
        try {
            dos.write(body, 0, body.length);
            dos.flush();
        } catch (IOException e) {
            log.error(e.getMessage());
        }
    }
}
```

- `RequestHandler` í´ë˜ìŠ¤ëŠ” Threadë¥¼ ìƒì†í•˜ê³ , **ì‚¬ìš©ìì˜ ìš”ì²­ì— ëŒ€í•œ ì²˜ë¦¬ì™€ ì‘ë‹µì— ëŒ€í•œ ì²˜ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” í´ë˜ìŠ¤**ì´ë‹¤.
- ì•ìœ¼ë¡œì˜ ëª¨ë“  ì‹¤ìŠµì€ `RequestHandler` í´ë˜ìŠ¤ì˜ `run()` ë©”ì†Œë“œì—ì„œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.
    - í•´ë‹¹ ë©”ì†Œë“œì˜ ë³µì¡ë„ê°€ ì¦ê°€í•˜ëŠ” ê²½ìš°, ìƒˆë¡œìš´ í´ë˜ìŠ¤ ë˜ëŠ” ë©”ì†Œë“œë¡œ ë¶„ë¦¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¦¬íŒ©í† ë§ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.
- `InputStream` : í´ë¼ì´ì–¸íŠ¸(ì›¹ ë¸Œë¼ìš°ì €)ì—ì„œ ì„œë²„ë¡œ ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ì „ë‹¬ë˜ëŠ” ë°ì´í„°ë¥¼ ë‹´ë‹¹
- `OutputStream` : ì„œë²„ì—ì„œ í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µì„ ë³´ë‚¼ ë•Œ ì „ë‹¬ë˜ëŠ” ë°ì´í„°ë¥¼ ë‹´ë‹¹
    - ì›¹ ì„œë²„ ì…ì¥ì—ì„œ ì´í•´!

ì „ì²´ì ì¸ íë¦„ì€,

- `ë¸Œë¼ìš°ì €` ì™€ `WebServerì˜ RequestHandler` ëŠ” `Socket` ì´ë¼ëŠ” í†µë¡œë¡œ í†µì‹ í•œë‹¤.
- í•´ë‹¹ í†µë¡œì˜ `InputStream` & `OutputStream` ìˆ˜ë‹¨ì„ í†µí•´ ë°ì´í„°ë¥¼ ì£¼ê³  ë°›ëŠ”ë‹¤.

> "í”„ë¡œê·¸ë˜ë° ì‹¤í–‰ ì¤‘ ë°œìƒí•˜ëŠ” ë¡œê·¸ ë©”ì„¸ì§€ë¥¼ ì£¼ì˜ ê¹Šê²Œ ì‚´í´ë³´ëŠ” ê²ƒì€ ì¢‹ì€ ìŠµê´€ ì¤‘ í•˜ë‚˜ì´ë‹¤."

## **ğŸ›µ ì‹¤ìŠµ ìš”êµ¬ì‚¬í•­**

**ìš”êµ¬ì‚¬í•­ 1 - index.html ì‘ë‹µí•˜ê¸°**

: í˜„ì¬ HTTP ì›¹ ì„œë²„ì— ì ‘ì†í•˜ë©´ ë¬´ì¡°ê±´ "Hello World" ë¼ëŠ” ë¬¸êµ¬ë§Œ ëœ¬ë‹¤. ì´ë¥¼ `http://localhost:8080/index.html` ë¡œ ì ‘ì†í–ˆì„ ë•Œ, `index.html` íŒŒì¼ì„ ì‘ë‹µí•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.

```java
try (InputStream in = connection.getInputStream(); OutputStream out = connection.getOutputStream()) {
  // TODO ì‚¬ìš©ì ìš”ì²­ì— ëŒ€í•œ ì²˜ë¦¬ëŠ” ì´ ê³³ì— êµ¬í˜„í•˜ë©´ ëœë‹¤.
  BufferedReader br = new BufferedReader(new InputStreamReader(in));

  String line = br.readLine();
  if (line == null) {return ;}
  String[] tokens = line.split(" ");

  while (!"".equals(line)) {
      line = br.readLine();
  }

  byte[] body = Files.readAllBytes(new File("./webapp" + tokens[1]).toPath());
  // byte[] body = "Hello World".getBytes();

  DataOutputStream dos = new DataOutputStream(out);
  response200Header(dos, body.length);
  responseBody(dos, body);
} catch (IOException e) {
  log.error(e.getMessage());
}
```

- `InputStream` , ì¦‰ í´ë¼ì´ì–¸íŠ¸ê°€ ë³´ë‚´ëŠ” ìš”ì²­ì„ í•œ ì¤„ ë‹¨ìœ„ë¡œ ì½ê¸° ìœ„í•´ `BufferedReader` ë¥¼ ì‚¬ìš©í•œë‹¤.
- `null` ì¸ ê²½ìš°ëŠ” `return`
- `line` ì„ **" "** ë‹¨ìœ„ë¡œ ì˜ë¼ ì €ì¥í•˜ê³ , `GET /index.html HTTP/1.1` ê°™ì€ í˜•ì‹ì´ë¯€ë¡œ `token[1]` ì— ìš”ì²­í•˜ëŠ” íŒŒì¼ì˜ ì •ë³´ê°€ ë‹´ê¸´ë‹¤.
- í•´ë‹¹ íŒŒì¼ ë°ì´í„°ë¥¼ `byte[]` ë¡œ ì½ì–´ `response` ì— ì „ë‹¬í•œë‹¤.

**ìš”êµ¬ì‚¬í•­ 2 - GET ë°©ì‹ìœ¼ë¡œ íšŒì›ê°€ì…í•˜ê¸°**

: íšŒì›ê°€ì… ë©”ë‰´ë¥¼ í´ë¦­í•˜ë©´ `http://localhost:8080/user/form.html` ë¡œ ì´ë™í•˜ë©´ì„œ íšŒì›ê°€ì…ì´ ê°€ëŠ¥í•˜ë‹¤. íšŒì›ê°€ì…ì„ ìˆ˜í–‰í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¡œ ì‚¬ìš©ì ì…ë ¥ê°’ì´ ì„œë²„ì— ì „ë‹¬ëœë‹¤.

```bash
/user/create?userId=javajigi&password=password&name=JaeSung&email=javajigi%40slipp.net
```

HTMLê³¼ URLì„ ë¹„êµí•˜ê³  ì‚¬ìš©ì ì…ë ¥ ê°’ì„ íŒŒì‹±í•´ `model.User` í´ë˜ìŠ¤ì— ì €ì¥í•œë‹¤.

```java
if (url.startsWith("/user/create")) {
    int index = url.indexOf("?");
    if (index != -1) {
        Map<String, String> map = HttpRequestUtils.parseQueryString(url.substring(index+1));
        User user = new User(map.get("userId"), map.get("password"), map.get("name"), map.get("email"));
        System.out.println(user);
    }
}
```

- URLì´ `/user/create` ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°, íšŒì›ê°€ì… ìš”ì²­ì´ë‹¤.
- ì¿¼ë¦¬ ë¬¸ìì—´ì„ (ì´ë¦„, ê°’) ê³¼ ê°™ì€ í˜•íƒœë¡œ ë¶„ì„í•˜ëŠ” `parseQueryString` ì„ ì´ìš©í•˜ì—¬ íŒŒë¼ë¯¸í„°ë¡œë¶€í„° ì‚¬ìš©ì ì…ë ¥ ê°’ì„ íŒŒì‹±í•œë‹¤.
- íŒŒì‹±í•œ ê°’ì„ `User` ê°ì²´ì— ë‹´ëŠ”ë‹¤.

**ìš”êµ¬ì‚¬í•­ 3 - POST ë°©ì‹ìœ¼ë¡œ íšŒì›ê°€ì…í•˜ê¸°**

: `http://localhost:8080/user/form.html` íŒŒì¼ì˜ `form` íƒœê·¸ ë©”ì†Œë“œë¥¼ **`POST`** ë¡œ ìˆ˜ì •í•œ í›„ íšŒì›ê°€ì…ì„ êµ¬í˜„í•œë‹¤.

```java
else if (tokens[0].equals("POST")) {
    while(!line.equals("")) {
        line = br.readLine();
        if (line.contains("Content-Length")) {
            String[] content = line.split(":");
            contLength = Integer.parseInt(content[1].trim());
        }
    }
    String body = IOUtils.readData(br, contLength);
    Map<String, String> map = HttpRequestUtils.parseQueryString(body);
    User user = new User(map.get("userId"), map.get("password"), map.get("name"), map.get("email"));
    System.out.println(user);
}
```

- `/user/create` ë¶„ê¸°ì—ì„œ ê±¸ëŸ¬ì§€ê³ , `GET` or `POST` ì´ë¯€ë¡œ í•œ ë²ˆ ë” ë¶„ê¸°ë¥¼ ë‚˜ëˆˆë‹¤.
- HTTP headerì™€ body ì‚¬ì´ì— **ë¹ˆ ê³µë°±ì´ ì¡´ì¬**í•œë‹¤ê³  í–ˆìœ¼ë¯€ë¡œ, ê·¸ ì „ê¹Œì§€ HTTP ìš”ì²­ì„ ì½ìœ¼ë©´ì„œ, `Content-Length` ê°’ì„ íƒìƒ‰í•œë‹¤.
    - ì´ë•Œ, `Content-Length: 55` ì™€ ê°™ì€ í˜•ì‹ì´ë¼ `content[1]` ì˜ ì²«ë²ˆì§¸ ìë¦¬ì— ê³µë°±ì´ í¬í•¨ë˜ë¯€ë¡œ `trim()` ì„ ì´ìš©í•´ ì´ë¥¼ ì œê±°í•œë‹¤.
- `IOUtils.readData` ì— `reader` ì™€ `size` ë¥¼ ì£¼ê³  ë°ì´í„°ë¥¼ ì½ê³  `GET` ê³¼ ë™ì¼í•˜ê²Œ ì‚¬ìš©ì ì…ë ¥ ê°’ì„ íŒŒì‹±í•œë‹¤.

**ìš”êµ¬ì‚¬í•­ 4 - 302 status code ì ìš©**

: íšŒì›ê°€ì…ì„ ì™„ë£Œí•œ í›„ `/index.html` ë¡œ ì´ë™í•˜ê³  ì‹¶ë‹¤.

```java
response302Header(dos, "/index.html");

...

private void response302Header(DataOutputStream dos, String url) {
    try {
        dos.writeBytes("HTTP/1.1 302 Redirect \r\n");
        dos.writeBytes("Location: " + url + " \r\n");
        dos.writeBytes("\r\n");
    } catch (IOException e) {
        log.error(e.getMessage());
    }
}
```

- **302** codeëŠ” 3XX Redirection í´ë˜ìŠ¤ì— ì†í•˜ëŠ” HTTP ìƒíƒœì½”ë“œì´ë‹¤.
    - í´ë¼ì´ì–¸íŠ¸ë¥¼ ì§€ì •ëœ ìœ„ì¹˜ë¡œ ì´ë™ì‹œí‚¤ê±°ë‚˜ ì°¸ì¡°í•˜ê²Œ í•˜ëŠ” ë“±ì˜ ë™ì‘ì„ ìˆ˜í–‰í•œë‹¤.
    - https://en.wikipedia.org/wiki/HTTP_302, https://nsinc.tistory.com/168

**ìš”êµ¬ì‚¬í•­ 5 - ë¡œê·¸ì¸í•˜ê¸°**

: ë¡œê·¸ì¸ ë©”ë‰´ë¥¼ í´ë¦­í•˜ë©´ `~/user/login.html` ë¡œ ì´ë™í•´ ë¡œê·¸ì¸í•  ìˆ˜ ìˆë‹¤. ì„±ê³µí•˜ë©´ `/index.html` ë¡œ ì´ë™í•˜ê³ , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ `/user/login_failed.html` ë¡œ ì´ë™í•´ì•¼ í•œë‹¤.

ì•ì—ì„œ íšŒì›ê°€ì…í•œ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ë¡œê·¸ì¸ ì„±ê³µ ì‹œ, ì¿ í‚¤ë¥¼ í™œìš©í•´ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ìœ ì§€í•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. ë¡œê·¸ì¸ì´ ì„±ê³µí•  ê²½ìš° ìš”ì²­ í—¤ë”ì˜ **Cookie í—¤ë” ê°’**ì´ `logined=true`, ì‹¤íŒ¨í•  ê²½ìš° `logined=false` ë¡œ ì „ë‹¬ë˜ì–´ì•¼ í•œë‹¤.

```java
else if (url.equals("/user/login")) {
    if (tokens[0].equals("POST")) {
        while(!line.equals("")) {
            line = br.readLine();
            log.debug("Header : {}", line);
            if (line.contains("Content-Length")) {
                String[] content = line.split(":");
                contLength= Integer.parseInt(content[1].trim());
            }
        }
        String body = IOUtils.readData(br, contLength);
        Map<String, String> map = HttpRequestUtils.parseQueryString(body);
        User user = DataBase.findUserById(map.get("userId"));
        log.debug("User : {}", user);
        if (user == null) {
            responseFail(dos, "/user/login_failed.html");
            return;
        }
        if (user.getPassword().equals(map.get("password"))) {
            response302Logined(dos);
        } else {
            responseFail(dos, "/user/login_failed.html");
            return;
        }
    }
}

private void response302Logined(DataOutputStream dos) {
    try {
        dos.writeBytes("HTTP/1.1 302 Redirect \r\n");
        dos.writeBytes("Location: /index.html \r\n");
        dos.writeBytes("Set-Cookie: logined=true \r\n");
        dos.writeBytes("\r\n");
    } catch (IOException e) {
        log.error(e.getMessage());
    }
}

private void responseFail(DataOutputStream dos, String url) throws IOException {
    byte[] body = Files.readAllBytes(new File("./webapp" + url).toPath());

    response200Header(dos, body.length);
    responseBody(dos, body);
}
```

- `/user/login` ì— **POST**ë¥¼ ë³´ë‚´ëŠ” ê²½ìš°, HTTP bodyë¥¼ ì½ì–´ ì‚¬ìš©ì ì…ë ¥ ê°’ì„ ì¶”ì¶œí•œë‹¤.
- DBì— ì €ì¥ë˜ì–´ ìˆëŠ” ê°’ê³¼ ë¹„êµí•œ í›„, ê° ê²½ìš°ì— ë§ê²Œ responseë¥¼ ì „ë‹¬í•œë‹¤.

**ìš”êµ¬ì‚¬í•­ 6 - ì‚¬ìš©ì ëª©ë¡ ì¶œë ¥**

: ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ ìƒíƒœì¸ ê²½ìš° `http://localhost:8080/user/list` ë¡œ ì ‘ê·¼í–ˆì„ ë•Œ ì‚¬ìš©ì ëª©ë¡ì„ ì¶œë ¥í•œë‹¤. ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ìƒíƒœë¼ë©´ `login.html` ë¡œ ì´ë™í•œë‹¤.

```java
else if (url.equals("/user/list")) {
    if (tokens[0].equals("GET")) {
        while(!line.equals("")) {
            line = br.readLine();
            log.debug("Header : {}", line);
            if (line.contains("Cookie")) {
                login = isLogin(line);
            }
        }
        if (!login) {
            responseFail(dos, "/user/login.html");
            return;
        }
        Collection<User> users = DataBase.findAll();
        StringBuilder sb = new StringBuilder();
        sb.append("<h1>íšŒì› ëª©ë¡</h1>");
        for (User user : users) {
            sb.append("<p>" + user.getUserId() + "</p>");
            sb.append("<p>" + user.getName() + "</p>");
            sb.append("<p>" + user.getEmail() + "</p>");
        }
        sb.append("<h2>ëª©ë¡ ë</h2>");
        byte[] body = sb.toString().getBytes();
        response200Header(dos, body.length);
        responseBody(dos, body);
    }
}
```

- `Cookie` ê°’ì„ ê°€ì ¸ì™€ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì¸ì§€ íŒë‹¨í•œë‹¤.
    - ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° `login.html` ì„ ì „ë‹¬í•œë‹¤.
    - `Database.findAll()` ë¡œ íšŒì›ê°€ì…ëœ ëª¨ë“  ì‚¬ìš©ìë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    - `StringBuilder` ë¥¼ ì´ìš©í•´ ì¶œë ¥í•  HTML codeë¥¼ ì‘ì„±í•˜ê³ , ì´ë¥¼ responseí•œë‹¤.

> **Stringì€ ë¶ˆë³€ ê°ì²´**ì´ë‹¤. 2ê°œì˜ String ê°ì²´ê°€ ìˆì„ ë•Œ, ë‘ ê°ì²´ë¥¼ ë”í•˜ëŠ” ì—°ì‚°ì€ ìƒˆë¡œìš´ Stringì„ ìƒì„±í•œë‹¤. ì´ ë•Œ, **ë©”ëª¨ë¦¬ í• ë‹¹ê³¼ í•´ì œë¥¼ ë°œìƒ**ì‹œì¼œ ë”í•˜ëŠ” ì—°ì‚°ì´ ë§ì•„ì§ˆìˆ˜ë¡ ì„±ëŠ¥ì ìœ¼ë¡œ ì¢‹ì§€ ì•Šë‹¤.
ë”°ë¼ì„œ, ë¬¸ìì—´ì„ ë”í•  ë•Œ ìƒˆë¡œìš´ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ê¸°ì¡´ì˜ ë°ì´í„°ì— ë”í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” **StringBuilder** í´ë˜ìŠ¤ê°€ ìƒê²¨ë‚¬ë‹¤.

**ìš”êµ¬ì‚¬í•­ 7 - CSS ì§€ì›í•˜ê¸°**

: CSS íŒŒì¼ì„ ì§€ì›í•˜ë„ë¡ êµ¬í˜„í•œë‹¤.

```java
else if (url.endsWith(".css")) {
    byte[] body = Files.readAllBytes(new File("./webapp" + url).toPath());
    response200CssHeader(dos, body.length);
    responseBody(dos, body);
}

...

private void response200CssHeader(DataOutputStream dos, int length) {
    try {
        dos.writeBytes("HTTP/1.1 200 OK \r\n");
        dos.writeBytes("Content-Type: text/css\r\n");
        dos.writeBytes("Content-Length: " + length + "\r\n");
        dos.writeBytes("\r\n");
    } catch (IOException e) {
        log.error(e.getMessage());
    }
}
```

- HTTP ìš”ì²­ì˜ headerì— `./css/style.css` ì™€ ê°™ì´ ë‚ ë¼ì˜¤ê¸°ì—, `endsWith()` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•´ ì´ë¥¼ ì¶”ì¶œí•œë‹¤.
- `Content-Type` ì´ `text/css` ë¡œ ë‹¬ë¼ì§„ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

---

# **ğŸš€ ì¶”ê°€ í•™ìŠµ ìë£Œ**

## **ğŸš¦ Gitê³¼ Github**

**Git**

: ìµœê·¼ì— ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” ë²„ì „ ê´€ë¦¬ ì‹œìŠ¤í…œ(Version Control System) ì˜ í•œ ì¢…ë¥˜, VCSì— ëŒ€í•œ ê¸°ë³¸ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ë„êµ¬ì´ë‹¤.

**Github**

: Gitì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥ê³¼ ë”ë¶ˆì–´ ê°œë°œìë“¤ì´ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¶”ê°€ì ì¸ ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ë‹¤.

- ì°¸ê³ 
  - [Learn Git Branching](http://pcottle.github.io/learnGitBranching)
  - [Sourcetree | Free Git GUI for Mac and Windows](http://www.sourcetreeapp.com)
    
## **ğŸš¥ ë¹Œë“œ ë„êµ¬ ë©”ì´ë¸**

### **ë¹Œë“œ ë„êµ¬**

: í”„ë¡œì íŠ¸ì™€ ê´€ë ¨í•œ ì„¤ì •ì„ ê´€ë¦¬í•˜ë©´ì„œ ì†ŒìŠ¤ì½”ë“œ(í”„ë¡œë•ì…˜, í…ŒìŠ¤íŠ¸)ì— ëŒ€í•œ ì»´íŒŒì¼, ì»´íŒŒì¼ì„ ìœ„í•´ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ê´€ë¦¬, í…ŒìŠ¤íŠ¸, ë°°í¬ë¥¼ ìœ„í•œ íŒ¨í‚¹ ì‘ì—… ë“±ì˜ ì‘ì—…ì„ ìë™í™”í•  ìˆ˜ ìˆë„ë¡ ì§€ì›í•˜ëŠ” ë„êµ¬

- í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°ì™€ ì˜ì¡´ì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê´€ë¦¬í•˜ë¯€ë¡œ, í”„ë¡œì íŠ¸ë¥¼ í†µí•© ê°œë°œ ë„êµ¬ í”„ë¡œì íŠ¸ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.
- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°œë°œì—ì„œ ë°œìƒí•˜ëŠ” ë‹¨ìˆœ, ë°˜ë³µì ì¸ ì‘ì—…ì„ ìë™í™”í•  ìˆ˜ ìˆë‹¤.
- ê°„ë‹¨í•œ ë°°í¬ ì‘ì—…ê¹Œì§€ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

### **Maven (ë©”ì´ë¸)ê³¼ Gradle (ê·¸ë˜ë“¤)**

**ë©”ì´ë¸**

: ìë°” ì§„ì˜ì—ì„œ ë” ì˜¤ë« ë™ì•ˆ ì‚¬ìš©í•´ì˜¨ ë¹Œë“œ ë„êµ¬ë¡œ, ì„¤ì • íŒŒì¼ì„ **XML**ë¡œ ì‘ì„±í•œë‹¤.

- **XML**ì„ ì‚¬ìš©í•˜ê¸°ì— í”„ë¡œì íŠ¸ì˜ í¬ê¸°ê°€ ì»¤ì§ˆìˆ˜ë¡ ë‚´ìš©ì´ ê¸¸ì–´ì§€ê³  ê°€ë…ì„±ì´ ë–¨ì–´ì§„ë‹¤.

```jsx
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<groupId>org.nhnnext</groupId>
	<artifactId>web-application-server</artifactId>
	<version>1.0</version>
	<packaging>jar</packaging>

	<properties>
		<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
		<project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
	</properties>

	<dependencies>
		<!-- unit testing -->
		<dependency>
			<groupId>junit</groupId>
			<artifactId>junit</artifactId>
			<version>4.11</version>
			<scope>test</scope>
		</dependency>

		<dependency>
			<groupId>com.google.guava</groupId>
			<artifactId>guava</artifactId>
			<version>18.0</version>
		</dependency>

		<!-- logger -->
		<dependency>
			<groupId>ch.qos.logback</groupId>
			<artifactId>logback-classic</artifactId>
			<version>1.1.2</version>
		</dependency>
	</dependencies>

	<build>
		<finalName>web-application-server</finalName>
		<sourceDirectory>src/main/java</sourceDirectory>
		<testSourceDirectory>src/test/java</testSourceDirectory>
		<testOutputDirectory>target/test-classes</testOutputDirectory>

		<resources>
			<resource>
				<directory>src/main/resources</directory>
			</resource>
		</resources>

		<plugins>
			<plugin>
				<artifactId>maven-eclipse-plugin</artifactId>
				<version>2.9</version>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-compiler-plugin</artifactId>
				<version>3.1</version>
				<configuration>
					<source>1.8</source>
					<target>1.8</target>
					<encoding>utf-8</encoding>
				</configuration>
			</plugin>
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-dependency-plugin</artifactId>
				<version>2.4</version>
				<executions>
					<execution>
						<id>copy-dependencies</id>
						<phase>package</phase>
						<goals>
							<goal>copy-dependencies</goal>
						</goals>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>
</project>
```

**ê·¸ë˜ë“¤**

: ìµœê·¼ ì¸ê¸°ë„ê°€ ë†’ì•„ì§€ëŠ” ë¹Œë“œ ë„êµ¬ë¡œ, `ê·¸ë£¨ë¹„` ë¼ëŠ” ì–¸ì–´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì„¤ì • íŒŒì¼ì„ ê´€ë¦¬í•˜ì—¬ ì„¤ì • íŒŒì¼ì— ëŒ€í•œ ìœ ì—°ì„±ë„ ë†’ê³ , ì½”ë”©ëŸ‰ë„ ë©”ì´ë¸ì˜ **XML**ì— ë¹„í•´ ì ë‹¤.

- ë¹Œë“œ ì†ë„ê°€ ë©”ì´ë¸ì— ë¹„í•´ 10~100ë°°ê°€ëŸ‰ ë¹ ë¥´ë‹¤.
- ê¸¸ì´ì™€ ê°€ë…ì„± ì¸¡ë©´ì—ì„œ íš¨ìœ¨ì ì´ë‹¤.

ë‘ ë¹Œë“œ ë„êµ¬ì˜ ê¸°ë³¸ ê°œë…ì€ ë¹„ìŠ·í•œ ì ì´ ë§ì•„, í•˜ë‚˜ì˜ ë¹Œë“œ ë„êµ¬ë§Œ ìµíˆë©´ ë‹¤ë¥¸ ë¹Œë“œ ë„êµ¬ì— ëŒ€í•œ í•™ìŠµ ë¹„ìš©ë„ ë‚®ë‹¤.

## **ğŸš§ ë””ë²„ê¹…ì„ ìœ„í•œ ë¡œê¹…(logging)**

ê°œë°œìëŠ” ë‹¤ìŒê³¼ ê°™ì€ ëª©ì ìœ¼ë¡œ ìˆ˜ë§ì€ ë©”ì„¸ì§€ë¥¼ ì¶œë ¥í•œë‹¤.

- ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•œ ëª©ì 
- ì• í”Œë¦¬ì¼€ì´ì…˜ì— ë¬¸ì œê°€ ë°œìƒí–ˆì„ ë•Œ ì›ì¸ì„ íŒŒì•…í•˜ê¸° ìœ„í•œ ë””ë²„ê¹… ëª©ì 

ì´ë•Œ, ì¹œìˆ™í•œ System.out.println() ìœ¼ë¡œ ì¶œë ¥í•˜ëŠ”ë°, ì´ëŠ” **ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ì„ ì €í•˜**ì‹œí‚¤ëŠ” ì›ì¸ì´ë‹¤.

- ì´ë¥¼ ì´ìš©í•´ ë””ë²„ê¹… ë©”ì„¸ì§€ë¥¼ ì¶œë ¥í•˜ë©´ íŒŒì¼ë¡œ ë©”ì„¸ì§€ê°€ ì¶œë ¥í•˜ê²Œ ë˜ëŠ”ë°, íŒŒì¼ì— ë©”ì„¸ì§€ë¥¼ ì¶œë ¥í•˜ëŠ” ì‘ì—…ì€ ìƒë‹¹í•œ ë¹„ìš©ì´ ë°œìƒí•œë‹¤.

### **logging ë¼ì´ë¸ŒëŸ¬ë¦¬**

ì´ì™€ ê°™ì€ ë‹¨ì ì„ ë³´ì™„í•˜ê¸° ìœ„í•´ **logging ë¼ì´ë¸ŒëŸ¬ë¦¬**ê°€ ë“±ì¥í–ˆë‹¤. ìë°” ì§„ì˜ì—ì„œ ë§ì´ ì‚¬ìš©í•˜ëŠ” ë¡œê¹… ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” Logback ì´ë‹¤.

ìë°” ì§„ì˜ì—ëŠ” ë§ì€ ë¡œê¹… ë¼ì´ë¸ŒëŸ¬ë¦¬ êµ¬í˜„ì²´ê°€ ì¡´ì¬í•˜ëŠ”ë°, ë” ì¢‹ì€ êµ¬í˜„ì²´ê°€ ë“±ì¥í•  ë•Œë§ˆë‹¤ ì „ì²´ ì†ŒìŠ¤ì½”ë“œì—ì„œ ë¡œê¹… ë¼ì´ë¸ŒëŸ¬ë¦¬ êµ¬í˜„ ë¶€ë¶„ì„ ìˆ˜ì •í•˜ëŠ” ì–´ë ¤ì›€ì´ ìˆë‹¤. ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ SLF4J ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í™œìš©í•´ ë¡œê¹… APIì— ëŒ€í•œ ì°½êµ¬ë¥¼ ì¼ì›í™”í–ˆë‹¤.

- ì¦‰, ìë°” ì†ŒìŠ¤ì½”ë“œëŠ” SLF4J ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ ë””ë²„ê¹… ë©”ì„¸ì§€ë¥¼ ë‚¨ê¸°ë©´ ì‹¤ì œë¡œ ë””ë²„ê¹… ë©”ì„¸ì§€ë¥¼ ì¶œë ¥í•˜ëŠ” êµ¬í˜„ì²´ëŠ” Log4J, Logback ì´ ë‹´ë‹¹í•˜ëŠ” ë°©ì‹ì´ë‹¤.

```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

private static final Logger log = LoggerFactory.getLogger(RequestHandler.class);
```

- í•´ë‹¹ í”„ë¡œì íŠ¸ëŠ” ë¡œê¹… êµ¬í˜„ì²´ë¡œ Logback ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•œë‹¤. í•˜ì§€ë§Œ ì´ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³  SLF4J ë¥¼ importí•˜ê³  ìˆë‹¤.
- Logback ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ êµ¬í˜„ì²´ëŠ” ë©”ì´ë¸ ì„¤ì • íŒŒì¼ì¸ pom.xml ì—ì„œ ì„¤ì •í•˜ê³  ìˆë‹¤.

### **ë¡œê·¸ ë ˆë²¨**

ë¡œê¹… ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ë©”ì„¸ì§€ ì¶œë ¥ ì—¬ë¶€ë¥¼ **ë¡œê·¸ ë ˆë²¨**ì„ í†µí•´ ê´€ë¦¬í•œë‹¤.

- `TRACE` = `log.trace()`, `DEBUG` = `log.debug()`, `INFO` = `log.info()`, `WARN` = `log.warn()`, `ERROR` = `log.error()`
- TRACE < DEBUG < INFO < WARN < ERROR ìˆœìœ¼ë¡œ ë†’ì•„ì§„ë‹¤.
    - ë ˆë²¨ì´ ë†’ì„ ìˆ˜ë¡ ì¶œë ¥ë˜ëŠ” ë©”ì„¸ì§€ëŠ” ì ì–´ì§€ê³ , ë‚®ì„ ìˆ˜ë¡ ë” ë§ì€ ë¡œê¹… ë ˆë²¨ì´ ì¶œë ¥ëœë‹¤.
- ê° ë©”ì„¸ì§€ì— ëŒ€í•œ ë¡œê·¸ ë ˆë²¨ì€ ë¡œê¹… ë©”ì„¸ì§€ë¥¼ êµ¬í˜„í•  ë•Œ ê²°ì •ëœë‹¤.

### **ë¡œê·¸ ë©”ì„¸ì§€ ìƒì„±**

ë¡œê·¸ ë©”ì„¸ì§€ ì¶œë ¥ ì‹œ ë‹¤ìŒê³¼ ê°™ì€ ë©”ì„¸ì§€ êµ¬í˜„ ë°©ì‹ì´ ì¼ë°˜ì ì´ë‹¤.

```java
log.debug("New Client Connect! Connected IP : " + connection.getInetAddress() + ", Port : " + conneciton.getPort());
```

- í•˜ì§€ë§Œ ìœ„ì™€ ê°™ì€ ë°©ì‹ì€ ë¡œê·¸ ë ˆë²¨ì´ INFO ë‚˜ WARN ì¸ ê²½ìš° êµ³ì´ í•´ë‹¹ ë©”ì†Œë“œì— ì¸ì ì „ë‹¬ì„ ìœ„í•´ ë¬¸ìì—´ì„ ë”í•˜ëŠ” ë¶€ë¶„ì´ ì‹¤í–‰ë  í•„ìš”ê°€ ì—†ë‹¤. (ì•„ê¹Œ ìœ„ì—ì„œ StringBuilder ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ì™€ ë™ì¼)
- SLF4J ëŠ” ì´ëŸ¬í•œ ë‹¨ì  ë³´ì™„ì„ ìœ„í•´ ë™ì ì¸ ë©”ì„¸ì§€ë¥¼ êµ¬í˜„í•˜ëŠ” ë³„ë„ì˜ ë©”ì†Œë“œë¥¼ ì œê³µí•œë‹¤.

```java
log.debug("New Client Connect! Connected IP : {}, Port : {}", connection.getInetAddress(), conneciton.getPort());
```

- ìœ„ ë°©ì‹ìœ¼ë¡œ debug() ë©”ì†Œë“œì—ì„œ ë¡œê·¸ ë ˆë²¨ì— ë”°ë¼ ë©”ì„¸ì§€ë¥¼ ë”í•  í•„ìš”ê°€ ìˆëŠ”ì§€ì˜ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ê²Œ ëœë‹¤.

Logback ì˜ ë¡œê·¸ ë ˆë²¨ê³¼ ë©”ì„¸ì§€ í˜•ì‹ì— ëŒ€í•œ ì„¤ì • íŒŒì¼ì€ logback.xml ì´ë©°, ì´ë¥¼ í†µí•´ ì¶œë ¥ë˜ëŠ” ë¡œê·¸ ë©”ì„¸ì§€ì˜ íŒ¨í„´ì„ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.

> Log4j, SLF4J ë¼ì´ë¸ŒëŸ¬ë¦¬ë³„ í…œí”Œë¦¿ ë˜í•œ ì¡´ì¬í•´, ë‹¨ìˆœ ë°˜ë³µì ìœ¼ë¡œ ë°œìƒí•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•˜ì—¬ ê°œë°œ ìƒì‚°ì„±ì„ ë†’ì´ëŠ” ë° ë„ì›€ì´ ë  ìˆ˜ ìˆë‹¤.